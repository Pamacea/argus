<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARGUS Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #000000;
      --bg-secondary: #111111;
      --bg-tertiary: #1a1a1a;
      --border-color: #333333;
      --border-light: #444444;
      --text-primary: #ffffff;
      --text-secondary: #888888;
      --text-muted: #666666;
      --accent: #0070f3;
      --accent-hover: #0060df;
      --success: #00d084;
      --warning: #f5a623;
      --error: #ff0055;
      --code-bg: #0d0d0d;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      line-height: 1.6;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-subtitle {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
      letter-spacing: 0.5px;
    }

    .nav {
      flex: 1;
      padding: 1rem 0;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-section-title {
      padding: 0 1.5rem;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.625rem 1.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      transition: all 0.15s ease;
      cursor: pointer;
      border-left: 2px solid transparent;
    }

    .nav-item:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .nav-item.active {
      color: var(--text-primary);
      background: var(--bg-tertiary);
      border-left-color: var(--accent);
    }

    .nav-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-color);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Main Content */
    .main-content {
      margin-left: 260px;
      flex: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-primary);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    .status-dot.error {
      background: var(--error);
    }

    .status-dot.warning {
      background: var(--warning);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover {
      background: var(--bg-secondary);
      border-color: var(--border-light);
    }

    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      border-color: var(--accent-hover);
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
    }

    /* Content Area */
    .content {
      flex: 1;
      padding: 2rem;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }

    .section {
      margin-bottom: 3rem;
    }

    .section.hidden {
      display: none;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-title svg {
      width: 20px;
      height: 20px;
      color: var(--text-secondary);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat {
      padding: 1.25rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-value.success {
      color: var(--success);
    }

    .stat-value.warning {
      color: var(--warning);
    }

    .stat-value.error {
      color: var(--error);
    }

    /* Tables */
    .table-container {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: var(--bg-secondary);
      padding: 0.875rem 1rem;
      text-align: left;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      font-weight: 600;
      border-bottom: 1px solid var(--border-color);
    }

    td {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.875rem;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: var(--bg-secondary);
    }

    /* Code */
    .code {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
      font-size: 0.8125rem;
      background: var(--code-bg);
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      color: var(--text-primary);
    }

    .code-block {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
      font-size: 0.8125rem;
      background: var(--code-bg);
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      border: 1px solid var(--border-color);
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 400px;
      overflow-y: auto;
    }

    /* Transaction Item */
    .transaction-item {
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .transaction-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .transaction-id {
      font-family: 'SF Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .transaction-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .transaction-prompt {
      margin-bottom: 1rem;
    }

    .transaction-prompt-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .transaction-prompt-content {
      font-size: 0.9375rem;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .transaction-response {
      background: var(--code-bg);
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .transaction-response-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .transaction-response-content {
      font-family: 'SF Mono', monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 300px;
      overflow-y: auto;
    }

    .transaction-meta {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* File Edit Transactions */
    .transaction-item.file-edit {
      border-left: 3px solid var(--accent);
      background: rgba(0, 112, 243, 0.05);
    }

    .transaction-response-content pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .transaction-prompt-content small {
      color: var(--text-secondary);
      font-size: 0.875em;
    }

    .transaction-meta-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Git Info */
    .transaction-git {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .transaction-git .code {
      background: var(--bg-tertiary);
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Droid Sans Mono', 'Source Code Pro', monospace;
      font-size: 0.8rem;
    }

    /* Git Badge for Activity */
    .git-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.125rem 0.5rem;
      background: rgba(0, 122, 255, 0.15);
      color: rgb(0, 122, 255);
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-left: 0.5rem;
    }

    /* Activity Feed */
    .activity-feed {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      transition: all 0.15s ease;
    }

    .activity-item:hover {
      background: var(--bg-tertiary);
    }

    .activity-icon {
      font-size: 1.5rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .activity-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .activity-time {
      font-size: 0.75rem;
      color: var(--text-secondary);
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Activity Changes - Diff Preview */
    .activity-changes {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: var(--bg-tertiary);
      border-radius: 6px;
      border-left: 2px solid var(--border-color);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .empty-state-description {
      font-size: 0.875rem;
    }

    /* Loading */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 3rem;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Endpoints List */
    .endpoint-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .endpoint-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      transition: all 0.15s ease;
    }

    .endpoint-item:hover {
      background: var(--bg-tertiary);
    }

    .endpoint-path {
      font-family: 'SF Mono', monospace;
      font-size: 0.875rem;
      color: var(--accent);
    }

    .endpoint-method {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .endpoint-method.get {
      background: rgba(0, 112, 243, 0.2);
      color: var(--accent);
    }

    .endpoint-method.post {
      background: rgba(0, 208, 132, 0.2);
      color: var(--success);
    }

    /* Search Box */
    .search-box {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.875rem;
      outline: none;
      transition: all 0.15s ease;
    }

    .search-input:focus {
      border-color: var(--accent);
      background: var(--bg-tertiary);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: var(--text-secondary);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-top: 2rem;
    }

    .pagination-btn {
      padding: 0.5rem 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--bg-tertiary);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-info {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">ARGUS</div>
      <div class="logo-subtitle">Sentinelle Omnisciente</div>
    </div>

    <div class="nav">
      <div class="nav-section">
        <div class="nav-section-title">Dashboard</div>
        <a href="#" class="nav-item active" data-section="dashboard">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
          Overview
        </a>
        <a href="#" class="nav-item" data-section="activity">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Recent Activity
        </a>
        <a href="#" class="nav-item" data-section="history">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          History / Log
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Data</div>
        <a href="#" class="nav-item" data-section="projects">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
          </svg>
          Indexed Projects
        </a>
        <a href="#" class="nav-item" data-section="memory">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          Memory Engine
        </a>
        <a href="#" class="nav-item" data-section="mcp">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/>
          </svg>
          MCP Tools
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">API</div>
        <a href="#" class="nav-item" data-section="server">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
          </svg>
          Server Endpoints
        </a>
        <a href="#" class="nav-item" data-section="api">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          API Documentation
        </a>
      </div>
    </div>

    <div class="sidebar-footer">
      <div>ARGUS v<span id="version">0.5.5</span></div>
      <div style="margin-top: 0.25rem; opacity: 0.7;">
        <a href="https://github.com/Pamacea/argus" target="_blank" style="color: inherit; text-decoration: none;">GitHub</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="page-title" id="pageTitle">Overview</h1>
        <div class="status-badge">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">Loading...</span>
        </div>
      </div>
      <div class="header-right">
        <button class="btn btn-sm" onclick="refreshData()">
          <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Refresh
        </button>
      </div>
    </header>

    <!-- Content -->
    <div class="content">
      <!-- Dashboard Section -->
      <section id="section-dashboard" class="section">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Index Statistics
          </h2>
        </div>

        <div class="stats-grid" id="statsGrid">
          <div class="stat">
            <div class="stat-label">Transactions</div>
            <div class="stat-value" id="statTransactions">-</div>
          </div>
          <div class="stat">
            <div class="stat-label">Hooks</div>
            <div class="stat-value" id="statHooks">-</div>
          </div>
          <div class="stat">
            <div class="stat-label">Indexed Files</div>
            <div class="stat-value" id="statFiles">-</div>
          </div>
          <div class="stat">
            <div class="stat-label">Database Size</div>
            <div class="stat-value" id="statSize">-</div>
          </div>
          <div class="stat">
            <div class="stat-label">Storage Engine</div>
            <div class="stat-value" id="statEngine">-</div>
          </div>
          <div class="stat">
            <div class="stat-label">Last Index</div>
            <div class="stat-value" id="statLastIndex" style="font-size: 1rem;">-</div>
          </div>
        </div>
      </section>

      <!-- Activity Section -->
      <section id="section-activity" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            Recent Activity
          </h2>
          <div style="font-size: 0.875rem; color: var(--text-secondary); font-weight: 400; margin-top: 0.25rem;">
            Quick overview of recent actions with context
          </div>
        </div>
        <div id="activityContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- History Section -->
      <section id="section-history" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            Complete Transaction Log
          </h2>
          <div style="font-size: 0.875rem; color: var(--text-secondary); font-weight: 400; margin-top: 0.25rem;">
            Full transaction history with all details
          </div>
        </div>

        <div class="search-box">
          <svg class="search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input type="text" class="search-input" id="historySearch" placeholder="Search transactions...">
        </div>

        <div id="historyContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>

        <div class="pagination" id="historyPagination">
          <button class="pagination-btn" id="prevPage" disabled>‚Üê Previous</button>
          <span class="pagination-info" id="pageInfo">Page 1</span>
          <button class="pagination-btn" id="nextPage">Next ‚Üí</button>
        </div>
      </section>

      <!-- Projects Section -->
      <section id="section-projects" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
            </svg>
            Indexed Projects
          </h2>
        </div>
        <div id="projectsContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- Memory Section -->
      <section id="section-memory" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            Memory Engine
          </h2>
        </div>
        <div id="memoryContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- MCP Section -->
      <section id="section-mcp" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/>
            </svg>
            MCP Tools
          </h2>
        </div>
        <div id="mcpContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- Server Section -->
      <section id="section-server" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
            </svg>
            Server Endpoints
          </h2>
        </div>
        <div id="serverContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>

      <!-- API Section -->
      <section id="section-api" class="section hidden">
        <div class="section-header">
          <h2 class="section-title">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            API Documentation
          </h2>
        </div>
        <div id="apiContent">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // API base URL
    const API_BASE = window.location.origin;

    // State
    let currentPage = 1;
    const pageSize = 10;
    let allTransactions = [];

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const section = item.dataset.section;

        // Update active state
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        // Show section
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`section-${section}`).classList.remove('hidden');

        // Update title
        const titles = {
          dashboard: 'Overview',
          activity: 'Recent Activity',
          history: 'Transaction History',
          projects: 'Indexed Projects',
          memory: 'Memory Engine',
          mcp: 'MCP Tools',
          server: 'Server Endpoints',
          api: 'API Documentation'
        };
        document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';

        // Load section data
        loadSectionData(section);
      });
    });

    // Format bytes
    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Format duration
    function formatDuration(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);

      if (hours > 0) {
        return `${hours}h ${minutes}m`;
      } else if (minutes > 0) {
        return `${minutes}m ${secs}s`;
      } else {
        return `${secs}s`;
      }
    }

    // Fetch data
    async function fetchJSON(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error(`Error fetching ${url}:`, error);
        return null;
      }
    }

    // Load section data
    async function loadSectionData(section) {
      switch (section) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'activity':
          loadActivity();
          break;
        case 'history':
          loadHistory();
          break;
        case 'projects':
          loadProjects();
          break;
        case 'memory':
          loadMemory();
          break;
        case 'mcp':
          loadMCP();
          break;
        case 'server':
          loadServer();
          break;
        case 'api':
          loadAPI();
          break;
      }
    }

    // Load dashboard
    async function loadDashboard() {
      const stats = await fetchJSON(`${API_BASE}/api/stats`);
      if (stats && stats.stats) {
        const s = stats.stats;
        document.getElementById('statTransactions').textContent = s.transactionCount || s.totalTransactions || 0;
        document.getElementById('statHooks').textContent = s.hookCount || s.totalHooks || 0;
        document.getElementById('statFiles').textContent = s.indexedFileCount || 0;
        document.getElementById('statSize').textContent = formatBytes(s.memorySize || 0);
        document.getElementById('statEngine').textContent = s.usingQdrant ? 'Qdrant' : 'SQLite';
        document.getElementById('statLastIndex').textContent = s.lastIndexTime ?
          new Date(s.lastIndexTime).toLocaleString() : 'Never';

        updateStatus(true);
      }
    }

    // Load activity
    // Generate intelligent summary from transaction
    function generateActivitySummary(tx) {
      const toolName = tx.toolName || 'Unknown';
      const timeAgo = getTimeAgo(tx.timestamp);
      const hasGit = tx.tags && tx.tags.includes('git_tracked');
      const hasChanges = tx.changePreview && (tx.changePreview.preview || tx.changePreview.preview?.added || tx.changePreview.preview?.removed);

      if (tx.category === 'file_modification' || tx.isFileEdit) {
        // File modification summary - ULTRA SHORT
        if (tx.prompt.includes('Edit')) {
          const match = tx.prompt.match(/Edit (.+?):/);
          const file = match ? match[1].split(/[/\\]/).pop() : 'a file';

          // Extract the WHY part (to ...) if present
          const whyMatch = tx.prompt.match(/\(to (.+?)\)/);
          const why = whyMatch ? whyMatch[1] : 'working on task';

          // Ultra short: "Modified X (to Y)"
          return {
            icon: 'üìù',
            title: `Modified ${file}`,
            description: why.length > 40 ? why.substring(0, 40) + '...' : why,
            time: timeAgo,
            git: hasGit,
            changePreview: hasChanges ? tx.changePreview : null
          };
        } else if (tx.prompt.includes('Write')) {
          const match = tx.prompt.match(/Write (.+?) \(/);
          const file = match ? match[1].split(/[/\\]/).pop() : 'a file';

          // Extract the WHY part (to ...) if present
          const whyMatch = tx.prompt.match(/\(to (.+?)\)/);
          const why = whyMatch ? whyMatch[1] : 'working on task';

          // Ultra short: "Created X (to Y)"
          return {
            icon: '‚ú®',
            title: `Created ${file}`,
            description: why.length > 40 ? why.substring(0, 40) + '...' : why,
            time: timeAgo,
            git: hasGit,
            changePreview: hasChanges ? tx.changePreview : null
          };
        }
      }

      // Tool execution summary - ULTRA SHORT
      switch(toolName) {
        case 'Bash':
          // Extract description from prompt
          const descMatch = tx.prompt.match(/Executed: (.+?)(?:\(|$)/);
          if (descMatch) {
            const desc = descMatch[1];
            return {
              icon: '‚ö°',
              title: 'Ran command',
              description: desc.length > 50 ? desc.substring(0, 50) + '...' : desc,
              time: timeAgo,
              git: hasGit,
              changePreview: null
            };
          }
          break;
        case 'Task':
          const taskMatch = tx.prompt.match(/Launched (.+?) agent: (.+)/);
          if (taskMatch) {
            return {
              icon: 'ü§ñ',
              title: `Used ${taskMatch[1]} agent`,
              description: taskMatch[2].length > 50 ? taskMatch[2].substring(0, 50) + '...' : taskMatch[2],
              time: timeAgo,
              git: hasGit,
              changePreview: null
            };
          }
          break;
      }

      // Fallback - use first 60 chars of prompt
      const prompt = tx.prompt || 'Unknown action';
      return {
        icon: 'üîß',
        title: toolName,
        description: prompt.length > 60 ? prompt.substring(0, 60) + '...' : prompt,
        time: timeAgo,
        git: hasGit,
        changePreview: null
      };
    }

    function getTimeAgo(timestamp) {
      const seconds = Math.floor((Date.now() - timestamp) / 1000);
      if (seconds < 60) return `${seconds}s ago`;
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
      return `${Math.floor(seconds / 86400)}d ago`;
    }

    async function loadActivity() {
      const content = document.getElementById('activityContent');
      const transactions = await fetchJSON(`${API_BASE}/api/transactions?limit=15`);

      if (transactions && transactions.transactions && transactions.transactions.length > 0) {
        // Generate intelligent summaries
        const activities = transactions.transactions
          .filter(tx => tx.toolName && tx.toolName !== 'unknown')
          .map(tx => generateActivitySummary(tx));

        content.innerHTML = `
          <div class="activity-feed">
            ${activities.map(activity => `
              <div class="activity-item">
                <div class="activity-icon">${activity.icon}</div>
                <div class="activity-content">
                  <div class="activity-title">
                    ${escapeHtml(activity.title)}
                    ${activity.git ? `<span class="git-badge">‚ö° Git</span>` : ''}
                  </div>
                  <div class="activity-description">${escapeHtml(activity.description)}</div>
                  ${activity.changePreview ? `
                  <div class="activity-changes">
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; font-size: 0.8rem;">
                      ${activity.changePreview.preview?.added ? `
                      <div style="flex: 1;">
                        <div style="color: #22c55e; font-weight: 500; margin-bottom: 0.25rem;">+ Added:</div>
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 0.5rem; border-radius: 4px; font-family: monospace; font-size: 0.75rem; color: #22c55e;">${escapeHtml(activity.changePreview.preview.added.substring(0, 100))}${activity.changePreview.preview.added.length > 100 ? '...' : ''}</div>
                      </div>
                      ` : ''}
                      ${activity.changePreview.preview?.removed ? `
                      <div style="flex: 1;">
                        <div style="color: #ef4444; font-weight: 500; margin-bottom: 0.25rem;">- Removed:</div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 0.5rem; border-radius: 4px; font-family: monospace; font-size: 0.75rem; color: #ef4444;">${escapeHtml(activity.changePreview.preview.removed.substring(0, 100))}${activity.changePreview.preview.removed.length > 100 ? '...' : ''}</div>
                      </div>
                      ` : ''}
                      ${activity.changePreview.preview && !activity.changePreview.preview.added && !activity.changePreview.preview.removed ? `
                      <div style="flex: 1;">
                        <div style="color: var(--text-secondary); font-weight: 500; margin-bottom: 0.25rem;">Content:</div>
                        <div style="background: var(--bg-tertiary); padding: 0.5rem; border-radius: 4px; font-family: monospace; font-size: 0.75rem;">${escapeHtml(activity.changePreview.preview.substring(0, 100))}${activity.changePreview.preview.length > 100 ? '...' : ''}</div>
                      </div>
                      ` : ''}
                    </div>
                  </div>
                  ` : ''}
                </div>
                <div class="activity-time">${activity.time}</div>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        content.innerHTML = `
          <div class="empty-state">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <div class="empty-state-title">No recent activity</div>
            <div class="empty-state-description">Your actions will appear here as intelligent summaries</div>
          </div>
        `;
      }
    }

    // Load history
    async function loadHistory() {
      const content = document.getElementById('historyContent');
      content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

      const data = await fetchJSON(`${API_BASE}/api/transactions?limit=100`);
      if (data && data.transactions) {
        allTransactions = data.transactions;
        renderHistoryPage();
      } else {
        content.innerHTML = `
          <div class="empty-state">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <div class="empty-state-title">No history yet</div>
            <div class="empty-state-description">Transactions will be logged here</div>
          </div>
        `;
      }
    }

    function renderHistoryPage() {
      const content = document.getElementById('historyContent');
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageTransactions = allTransactions.slice(start, end);

      content.innerHTML = pageTransactions.map(tx => `
        <div class="transaction-item ${tx.isFileEdit ? 'file-edit' : ''}">
          <div class="transaction-header">
            <span class="transaction-id">${tx.id}</span>
            <span class="transaction-time">${new Date(tx.timestamp).toLocaleString()}</span>
          </div>
          <div class="transaction-prompt">
            <div class="transaction-prompt-label">${tx.isFileEdit ? 'üìù File Operation' : 'üîß Tool Execution'}</div>
            <div class="transaction-prompt-content">
              <strong>${escapeHtml(tx.toolName || 'Unknown Tool')}</strong>
              ${tx.prompt && tx.prompt !== 'unknown called' ? `<br><small>${escapeHtml(tx.prompt)}</small>` : ''}
            </div>
          </div>
          ${tx.git ? `
          <div class="transaction-git" style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(0, 122, 255, 0.1); border-left: 3px solid rgb(0, 122, 255); border-radius: 4px;">
            <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
              <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              <strong>Git Repository</strong>
              ${tx.git.branch ? `<span style="color: var(--text-secondary);">‚Ä¢</span><span class="code">${escapeHtml(tx.git.branch)}</span>` : ''}
            </div>
            ${tx.git.lastCommit ? `
            <div style="margin-top: 0.5rem; font-size: 0.875rem;">
              <div style="color: var(--text-secondary); margin-bottom: 0.25rem;">Last Commit:</div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span class="code" style="font-size: 0.8rem;">${escapeHtml(tx.git.lastCommit.hash?.substring(0, 8))}</span>
                <span style="color: var(--text-secondary);">-</span>
                <span>${escapeHtml(tx.git.lastCommit.message?.substring(0, 80) || 'No message')}${tx.git.lastCommit.message?.length > 80 ? '...' : ''}</span>
              </div>
            </div>
            ` : ''}
          </div>
          ` : ''}
          ${tx.changePreview && tx.changePreview.git && tx.changePreview.git.diffPreview ? `
          <div style="margin: 0.5rem 0; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 4px; font-size: 0.875rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.8rem;">
              <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              Git Diff Preview
            </div>
            <pre style="margin: 0; padding: 0.5rem; background: var(--bg-secondary); border-radius: 3px; font-size: 0.8rem; overflow-x: auto; color: var(--text-primary);">${escapeHtml(tx.changePreview.git.diffPreview)}</pre>
            ${tx.changePreview.git.fullDiffAvailable ? '<div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">Full diff available in git</div>' : ''}
          </div>
          ` : ''}
          ${tx.response && tx.response !== '{}' && tx.response.length > 0 ? `
          <div class="transaction-response">
            <div class="transaction-response-label">Response</div>
            <div class="transaction-response-content"><pre>${escapeHtml(tx.response)}</pre></div>
          </div>
          ` : ''}
          <div class="transaction-meta">
            <span class="transaction-meta-tag">
              <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
              </svg>
              ${tx.category || 'general'}
            </span>
            ${tx.tags && tx.tags.length > 0 ? tx.tags.map(tag => `
              <span class="transaction-meta-tag">#${escapeHtml(tag)}</span>
            `).join('') : ''}
            ${tx.duration ? `<span class="transaction-meta-tag">${tx.duration}ms</span>` : ''}
          </div>
        </div>
      `).join('');

      // Update pagination
      const totalPages = Math.ceil(allTransactions.length / pageSize);
      document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages || 1}`;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages;
    }

    // Search history
    document.getElementById('historySearch').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      if (query) {
        const filtered = allTransactions.filter(tx =>
          tx.prompt?.toLowerCase().includes(query) ||
          tx.response?.toLowerCase().includes(query) ||
          tx.id?.toLowerCase().includes(query)
        );
        allTransactions = filtered;
        currentPage = 1;
      } else {
        loadHistory();
        return;
      }
      renderHistoryPage();
    });

    // Pagination
    document.getElementById('prevPage').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderHistoryPage();
      }
    });

    document.getElementById('nextPage').addEventListener('click', () => {
      const totalPages = Math.ceil(allTransactions.length / pageSize);
      if (currentPage < totalPages) {
        currentPage++;
        renderHistoryPage();
      }
    });

    // Load projects
    async function loadProjects() {
      const content = document.getElementById('projectsContent');
      const data = await fetchJSON(`${API_BASE}/api/indexed`);

      if (data && data.projects && data.projects.length > 0) {
        content.innerHTML = data.projects.map(project => `
          <div class="transaction-item">
            <div class="transaction-header">
              <div style="font-weight: 600; font-size: 1.1rem;">${escapeHtml(project.name)}</div>
              <span class="status-badge" style="background: rgba(0, 208, 132, 0.2); color: var(--success);">
                ‚úì ${project.indexed === 'full' ? 'Fully' : 'Partially'} Indexed
              </span>
            </div>
            <div style="margin-bottom: 0.5rem;">
              <span class="code">${escapeHtml(project.projectDir || project.project)}</span>
            </div>
            <div style="display: flex; gap: 2rem; font-size: 0.875rem; color: var(--text-secondary);">
              <span>üìÑ <strong>${project.fileCount || 0}</strong> files</span>
              <span>üïí ${formatDuration((Date.now() - (project.lastIndexed || project.timestamp)) / 1000)} ago</span>
            </div>
          </div>
        `).join('');
      } else {
        content.innerHTML = `
          <div class="empty-state">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
            </svg>
            <div class="empty-state-title">No projects indexed</div>
            <div class="empty-state-description">Projects will be automatically indexed when you start a session</div>
          </div>
        `;
      }
    }

    // Load memory
    async function loadMemory() {
      const content = document.getElementById('memoryContent');
      const stats = await fetchJSON(`${API_BASE}/api/stats`);

      if (stats && stats.stats) {
        const s = stats.stats;
        content.innerHTML = `
          <div class="stats-grid">
            <div class="stat">
              <div class="stat-label">Storage Engine</div>
              <div class="stat-value">${s.usingQdrant ? 'Qdrant Vector DB' : 'SQLite (TF-IDF)'}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Database Size</div>
              <div class="stat-value">${formatBytes(s.memorySize || 0)}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Total Transactions</div>
              <div class="stat-value">${s.transactionCount || s.totalTransactions || 0}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Last Index</div>
              <div class="stat-value" style="font-size: 1rem;">${s.lastIndexTime ? new Date(s.lastIndexTime).toLocaleString() : 'Never'}</div>
            </div>
          </div>
          <div class="transaction-item">
            <div style="font-weight: 600; margin-bottom: 1rem;">Memory Engine Status</div>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                <span style="color: var(--text-secondary);">Engine Type</span>
                <span style="font-weight: 600;">${s.usingQdrant ? 'Vector Search' : 'Local Search'}</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                <span style="color: var(--text-secondary);">Status</span>
                <span style="font-weight: 600; color: var(--success);">Operational</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                <span style="color: var(--text-secondary);">Documents Indexed</span>
                <span style="font-weight: 600;">${s.transactionCount || s.totalTransactions || 0}</span>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Load MCP
    async function loadMCP() {
      const content = document.getElementById('mcpContent');
      const tools = [
        { name: 'argus__check_hooks', description: 'Check hooks and context before operations' },
        { name: 'argus__search_memory', description: 'Semantic search in transaction history' },
        { name: 'argus__save_transaction', description: 'Save operation results to memory' },
        { name: 'argus__get_history', description: 'Get transaction history with pagination' },
        { name: 'argus__get_stats', description: 'Get system statistics and metrics' },
        { name: 'argus__index_codebase', description: 'Index project files for search' },
        { name: 'argus__search_code', description: 'Search indexed codebase' }
      ];

      content.innerHTML = `
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Tool Name</th>
                <th>Description</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              ${tools.map(tool => `
                <tr>
                  <td><span class="code">${tool.name}</span></td>
                  <td>${tool.description}</td>
                  <td><span style="color: var(--success); font-weight: 600;">Active</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // Load server
    async function loadServer() {
      const content = document.getElementById('serverContent');
      const status = await fetchJSON(`${API_BASE}/api/status`);

      if (status && status.server) {
        const s = status.server;
        content.innerHTML = `
          <div class="stats-grid">
            <div class="stat">
              <div class="stat-label">Version</div>
              <div class="stat-value" style="font-size: 1.5rem;">${s.version || '0.5.5'}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Platform</div>
              <div class="stat-value" style="font-size: 1.5rem;">${s.platform || 'Unknown'}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Node.js</div>
              <div class="stat-value" style="font-size: 1.5rem;">${s.nodeVersion || 'Unknown'}</div>
            </div>
            <div class="stat">
              <div class="stat-label">Uptime</div>
              <div class="stat-value" style="font-size: 1.5rem;">${formatDuration(s.uptime || 0)}</div>
            </div>
          </div>
          <div class="transaction-item">
            <div style="font-weight: 600; margin-bottom: 1rem;">Process Information</div>
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                <span style="color: var(--text-secondary);">Process ID</span>
                <span class="code">${s.pid || 'N/A'}</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                <span style="color: var(--text-secondary);">Architecture</span>
                <span style="font-weight: 600;">${s.arch || 'Unknown'}</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                <span style="color: var(--text-secondary);">Hostname</span>
                <span class="code">${s.hostname || 'localhost'}</span>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Load API
    async function loadAPI() {
      const content = document.getElementById('apiContent');
      const endpoints = [
        { path: '/health', method: 'GET', description: 'Health check endpoint' },
        { path: '/api/status', method: 'GET', description: 'Server status and metrics' },
        { path: '/api/stats', method: 'GET', description: 'Index statistics' },
        { path: '/api/indexed', method: 'GET', description: 'List indexed projects' },
        { path: '/api/transactions', method: 'GET', description: 'Get transaction history' },
        { path: '/api/search', method: 'POST', description: 'Search transactions' },
        { path: '/api/docs', method: 'GET', description: 'Interactive API documentation' }
      ];

      content.innerHTML = `
        <div class="endpoint-list">
          ${endpoints.map(ep => `
            <div class="endpoint-item">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <span class="endpoint-method ${ep.method.toLowerCase()}">${ep.method}</span>
                <span class="endpoint-path">${ep.path}</span>
              </div>
              <span style="color: var(--text-secondary); font-size: 0.875rem;">${ep.description}</span>
            </div>
          `).join('')}
        </div>
        <div style="margin-top: 2rem; text-align: center;">
          <a href="/api/docs" target="_blank" class="btn btn-primary">
            View Interactive Documentation ‚Üí
          </a>
        </div>
      `;
    }

    // Update status
    function updateStatus(isHealthy) {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');

      if (isHealthy) {
        dot.classList.remove('error', 'warning');
        text.textContent = 'All Systems Operational';
      } else {
        dot.classList.add('error');
        text.textContent = 'System Degraded';
      }
    }

    // Refresh all data
    function refreshData() {
      const activeSection = document.querySelector('.nav-item.active');
      if (activeSection) {
        loadSectionData(activeSection.dataset.section);
      }
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
      loadDashboard();

      // Auto-refresh every 30 seconds
      setInterval(refreshData, 30000);
    });
  </script>
</body>
</html>
